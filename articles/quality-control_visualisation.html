<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quality control and visualisation with SPIAT • SPIAT</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quality control and visualisation with SPIAT">
<meta property="og:description" content="SPIAT">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPIAT</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/SPIAT.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/basic_analysis.html">Basic analyses with SPIAT</a>
    </li>
    <li>
      <a href="../articles/cell-colocalisation.html">Quantifying cell colocalisation with SPIAT</a>
    </li>
    <li>
      <a href="../articles/data_reading-formatting.html">Reading in data and data formatting in SPIAT</a>
    </li>
    <li>
      <a href="../articles/neighborhood.html">Identifying cellular neighborhood with SPIAT</a>
    </li>
    <li>
      <a href="../articles/quality-control_visualisation.html">Quality control and visualisation with SPIAT</a>
    </li>
    <li>
      <a href="../articles/spatial-heterogeneity.html">Spatial heterogeneity with SPIAT</a>
    </li>
    <li>
      <a href="../articles/tissue-structure.html">Characterising tissue structure with SPIAT</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/trigosteam/SPIAT/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quality control and visualisation with
SPIAT</h1>
                        <h4 data-toc-skip class="author">Yuzhou
Feng</h4>
            
            <h4 data-toc-skip class="date">2023-11-02</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/trigosteam/SPIAT/blob/HEAD/vignettes/quality-control_visualisation.Rmd" class="external-link"><code>vignettes/quality-control_visualisation.Rmd</code></a></small>
      <div class="hidden name"><code>quality-control_visualisation.Rmd</code></div>

    </div>

    
    
<p>First we load the SPIAT library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://trigosteam.github.io/SPIAT/" class="external-link">SPIAT</a></span><span class="op">)</span></span></code></pre></div>
<p>Here we present some quality control steps implemented in SPIAT to
check for the quality of phenotyping, help detect uneven staining, and
other potential technical artefacts.</p>
<p>In this vignette we will use an inForm data file that’s already been
formatted for SPIAT with <code><a href="../reference/format_image_to_spe.html">format_image_to_spe()</a></code>, which we
can load with <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code>. We will use
<code><a href="../reference/define_celltypes.html">define_celltypes()</a></code> to define the cells with certain
combinations of markers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"simulated_image"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># define cell types</span></span>
<span><span class="va">formatted_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_celltypes.html">define_celltypes</a></span><span class="op">(</span></span>
<span>    <span class="va">simulated_image</span>, </span>
<span>    categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour_marker"</span>,<span class="st">"Immune_marker1,Immune_marker2"</span>, </span>
<span>                   <span class="st">"Immune_marker1,Immune_marker3"</span>, </span>
<span>                   <span class="st">"Immune_marker1,Immune_marker2,Immune_marker4"</span>, <span class="st">"OTHER"</span><span class="op">)</span>, </span>
<span>    category_colname <span class="op">=</span> <span class="st">"Phenotype"</span>, </span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour"</span>, <span class="st">"Immune1"</span>, <span class="st">"Immune2"</span>, <span class="st">"Immune3"</span>, <span class="st">"Others"</span><span class="op">)</span>,</span>
<span>    new_colname <span class="op">=</span> <span class="st">"Cell.Type"</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="visualise-marker-levels">Visualise marker levels<a class="anchor" aria-label="anchor" href="#visualise-marker-levels"></a>
</h2>
<div class="section level3">
<h3 id="boxplots-of-marker-intensities">Boxplots of marker intensities<a class="anchor" aria-label="anchor" href="#boxplots-of-marker-intensities"></a>
</h3>
<p>Phenotyping of cells can be verified comparing marker intensities of
cells labelled positive and negative for a marker. Cells positive for a
marker should have high levels of the marker. An unclear separation of
marker intensities between positive and negative cells would suggest
phenotypes have not been accurately assigned. We can use
<code><a href="../reference/marker_intensity_boxplot.html">marker_intensity_boxplot()</a></code> to produce a boxplot for cells
phenotyped as being positive or negative for a marker.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/marker_intensity_boxplot.html">marker_intensity_boxplot</a></span><span class="op">(</span><span class="va">formatted_image</span>, <span class="st">"Immune_marker1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-3-1.png" width="307.2"></p>
<p>Note that if phenotypes were obtained from software that uses machine
learning to determine positive cells, which generally also take into
account properties such as cell shape, nucleus size etc., rather than a
strict threshold, some negative cells will have high marker intensities,
and vice versa. In general, a limited overlap of whiskers or outlier
points is tolerated and expected. However, overlapping boxplots suggests
unreliable phenotyping.</p>
</div>
<div class="section level3">
<h3 id="scatter-plots-of-marker-levels">Scatter plots of marker levels<a class="anchor" aria-label="anchor" href="#scatter-plots-of-marker-levels"></a>
</h3>
<p>Uneven marker staining or high background intensity can be identified
with <code><a href="../reference/plot_cell_marker_levels.html">plot_cell_marker_levels()</a></code>. This produces a scatter
plot of the intensity of a marker in each cell. This should be
relatively even across the image and all phenotyped cells. Cells that
were not phenotyped as being positive for the particular marker are
excluded.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cell_marker_levels.html">plot_cell_marker_levels</a></span><span class="op">(</span><span class="va">formatted_image</span>, <span class="st">"Immune_marker1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="heatmaps-of-marker-levels">Heatmaps of marker levels<a class="anchor" aria-label="anchor" href="#heatmaps-of-marker-levels"></a>
</h3>
<p>For large images, there is also the option of ‘blurring’ the image,
where the image is split into multiple small areas, and marker
intensities are averaged within each. The image is blurred based on the
<code>num_splits</code> parameter.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_marker_level_heatmap.html">plot_marker_level_heatmap</a></span><span class="op">(</span><span class="va">formatted_image</span>, num_splits <span class="op">=</span> <span class="fl">100</span>, <span class="st">"Tumour_marker"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-5-1.png" width="75%"></p>
</div>
</div>
<div class="section level2">
<h2 id="identifying-incorrect-phenotypes">Identifying incorrect phenotypes<a class="anchor" aria-label="anchor" href="#identifying-incorrect-phenotypes"></a>
</h2>
<p>We may see cells with biologically implausible combination of markers
present in the input data when using
<code>unique(spe_object$Phenotype)</code>. For example, cells might be
incorrectly typed as positive for two markers known to not co-occur in a
single cell type. Incorrect cell phenotypes may be present due to low
cell segmentation quality, antibody ‘bleeding’ from one cell to another
or inadequate marker thresholding.</p>
<p>If the number of incorrectly phenotyped cells is small (&lt;5%), we
advise simply removing these cells (see below). If it is a higher
proportion, we recommend checking the cell segmentation and phenotyping
methods, as a more systematic problem might be present.</p>
<div class="section level3">
<h3 id="removing-cells-with-incorrect-phenotypes">Removing cells with incorrect phenotypes<a class="anchor" aria-label="anchor" href="#removing-cells-with-incorrect-phenotypes"></a>
</h3>
<p>If you identify incorrect phenotypes or have any properties (columns)
that you want to exclude you can use <code><a href="../reference/select_celltypes.html">select_celltypes()</a></code>.
Set <code>celltypes</code> the values that you want to keep or exclude
for a column (<code>feature_colname</code>). Set <code>keep</code> as
<code>TRUE</code> to include these cells and <code>FALSE</code> to
exclude them.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_celltypes.html">select_celltypes</a></span><span class="op">(</span></span>
<span>  <span class="va">formatted_image</span>, keep<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>  celltypes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour_marker"</span>,<span class="st">"Immune_marker1,Immune_marker3"</span>, </span>
<span>                <span class="st">"Immune_marker1,Immune_marker2"</span>,</span>
<span>                <span class="st">"Immune_marker1,Immune_marker2,Immune_marker4"</span><span class="op">)</span>,</span>
<span>  feature_colname <span class="op">=</span> <span class="st">"Phenotype"</span><span class="op">)</span></span>
<span><span class="co"># have a look at what phenotypes are present</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">data_subset</span><span class="op">$</span><span class="va">Phenotype</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Immune_marker1,Immune_marker2"               </span></span>
<span><span class="co">## [2] "Tumour_marker"                               </span></span>
<span><span class="co">## [3] "Immune_marker1,Immune_marker2,Immune_marker4"</span></span>
<span><span class="co">## [4] "Immune_marker1,Immune_marker3"</span></span></code></pre>
<p>In this vignette we will work with all the original phenotypes
present in <code>formatted_image</code>.</p>
</div>
<div class="section level3">
<h3 id="dimensionality-reduction-to-identify-misclassified-cells">Dimensionality reduction to identify misclassified cells<a class="anchor" aria-label="anchor" href="#dimensionality-reduction-to-identify-misclassified-cells"></a>
</h3>
<p>We can also check for specific misclassified cells using
dimensionality reduction. SPIAT offers tSNE and UMAPs based on marker
intensities to visualise cells. Cells of distinct types should be
forming clearly different clusters.</p>
<p>The generated dimensionality reduction plots are interactive, and
users can hover over each cell and obtain the cell ID. Users can then
remove specific misclassified cells.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First predict the phenotypes (this is for generating not 100% accurate phenotypes)</span></span>
<span><span class="va">predicted_image2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_phenotypes.html">predict_phenotypes</a></span><span class="op">(</span>spe_object <span class="op">=</span> <span class="va">simulated_image</span>,</span>
<span>                                      thresholds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                      tumour_marker <span class="op">=</span> <span class="st">"Tumour_marker"</span>,</span>
<span>                                      baseline_markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Immune_marker1"</span>, </span>
<span>                                                           <span class="st">"Immune_marker2"</span>, </span>
<span>                                                           <span class="st">"Immune_marker3"</span>, </span>
<span>                                                           <span class="st">"Immune_marker4"</span><span class="op">)</span>,</span>
<span>                                      reference_phenotypes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Tumour_marker  threshold intensity:  0.445450443784465"</span></span></code></pre>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<pre><code><span><span class="co">## [1] "Immune_marker1  threshold intensity:  0.116980867970434"</span></span></code></pre>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-7-2.png" width="700"></p>
<pre><code><span><span class="co">## [1] "Immune_marker2  threshold intensity:  0.124283809517202"</span></span></code></pre>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-7-3.png" width="700"></p>
<pre><code><span><span class="co">## [1] "Immune_marker3  threshold intensity:  0.0166413130263845"</span></span></code></pre>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-7-4.png" width="700"></p>
<pre><code><span><span class="co">## [1] "Immune_marker4  threshold intensity:  0.00989731350898589"</span></span></code></pre>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-7-5.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Then define the cell types based on predicted phenotypes</span></span>
<span><span class="va">predicted_image2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_celltypes.html">define_celltypes</a></span><span class="op">(</span></span>
<span>  <span class="va">predicted_image2</span>, </span>
<span>  categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour_marker"</span>, <span class="st">"Immune_marker1,Immune_marker2"</span>,</span>
<span>                 <span class="st">"Immune_marker1,Immune_marker3"</span>, </span>
<span>                 <span class="st">"Immune_marker1,Immune_marker2,Immune_marker4"</span><span class="op">)</span>, </span>
<span>  category_colname <span class="op">=</span> <span class="st">"Phenotype"</span>,</span>
<span>  names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour"</span>, <span class="st">"Immune1"</span>, <span class="st">"Immune2"</span>,  <span class="st">"Immune3"</span><span class="op">)</span>,</span>
<span>  new_colname <span class="op">=</span> <span class="st">"Cell.Type"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Delete cells with unrealistic marker combinations from the dataset</span></span>
<span><span class="va">predicted_image2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/select_celltypes.html">select_celltypes</a></span><span class="op">(</span><span class="va">predicted_image2</span>, <span class="st">"Undefined"</span>, feature_colname <span class="op">=</span> <span class="st">"Cell.Type"</span>,</span>
<span>                   keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># TSNE plot</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensionality_reduction_plot.html">dimensionality_reduction_plot</a></span><span class="op">(</span><span class="va">predicted_image2</span>, plot_type <span class="op">=</span> <span class="st">"TSNE"</span>, </span>
<span>                                   feature_colname <span class="op">=</span> <span class="st">"Cell.Type"</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code><a href="../reference/dimensionality_reduction_plot.html">dimensionality_reduction_plot()</a></code> only prints a
static version of the UMAP or tSNE plot. If the user wants to interact
with this plot, they can pass the result to the <code>ggplotly()</code>
function from the <code>plotly</code> package. Due to the file size
restriction, we only show a screenshot of the interactive tSNE plot.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plotly</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">ggplotly</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> </span></code></pre></div>
<p><img src="tSNE1.jpg" width="70%"></p>
<p>The plot shows that there are four clear clusters based on marker
intensities. This is consistent with the cell definition from the marker
combinations from the “Phenotype” column. (The interactive t-SNE plot
would allow users to hover the cursor on the misclassified cells and see
their cell IDs.) In this example, Cell_3302, Cell_4917, Cell_2297,
Cell_488, Cell_4362, Cell_4801, Cell_2220, Cell_3431, Cell_533,
Cell_4925, Cell_4719, Cell_469, Cell_1929, Cell_310, Cell_2536,
Cell_321, and Cell_4195 are obviously misclassified according to this
plot.</p>
<p>We can use <code><a href="../reference/select_celltypes.html">select_celltypes()</a></code> to delete the
misclassified cells.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted_image2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/select_celltypes.html">select_celltypes</a></span><span class="op">(</span><span class="va">predicted_image2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cell_3302"</span>, <span class="st">"Cell_4917"</span>, <span class="st">"Cell_2297"</span>, </span>
<span>                                       <span class="st">"Cell_488"</span>, <span class="st">"Cell_4362"</span>, <span class="st">"Cell_4801"</span>, </span>
<span>                                       <span class="st">"Cell_2220"</span>, <span class="st">"Cell_3431"</span>, <span class="st">"Cell_533"</span>, </span>
<span>                                       <span class="st">"Cell_4925"</span>, <span class="st">"Cell_4719"</span>, <span class="st">"Cell_469"</span>, </span>
<span>                                       <span class="st">"Cell_1929"</span>, <span class="st">"Cell_310"</span>, <span class="st">"Cell_2536"</span>, </span>
<span>                                       <span class="st">"Cell_321"</span>, <span class="st">"Cell_4195"</span><span class="op">)</span>, </span>
<span>                   feature_colname <span class="op">=</span> <span class="st">"Cell.ID"</span>, keep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Then plot the TSNE again (not interactive). This time we see there
are fewer misclassified cells.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># TSNE plot</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dimensionality_reduction_plot.html">dimensionality_reduction_plot</a></span><span class="op">(</span><span class="va">predicted_image2</span>, plot_type <span class="op">=</span> <span class="st">"TSNE"</span>, feature_colname <span class="op">=</span> <span class="st">"Cell.Type"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotly::ggplotly(g) # uncomment this code to interact with the plot</span></span></code></pre></div>
<p><img src="tSNE2.jpg" width="70%"></p>
</div>
</div>
<div class="section level2">
<h2 id="visualising-tissues">Visualising tissues<a class="anchor" aria-label="anchor" href="#visualising-tissues"></a>
</h2>
<p>In addition to the marker level tissue plots for QC, SPIAT has other
methods for visualising markers and phenotypes in tissues.</p>
<div class="section level3">
<h3 id="categorical-dot-plot">Categorical dot plot<a class="anchor" aria-label="anchor" href="#categorical-dot-plot"></a>
</h3>
<p>We can see the location of all cell types (or any column in the data)
in the tissue with <code><a href="../reference/plot_cell_categories.html">plot_cell_categories()</a></code>. Each dot in the
plot corresponds to a cell and cells are coloured by cell type. Any cell
types present in the data but not in the cell types of interest will be
put in the category “OTHER” and coloured lightgrey.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"darkcyan"</span>, <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="../reference/plot_cell_categories.html">plot_cell_categories</a></span><span class="op">(</span>spe_object <span class="op">=</span> <span class="va">formatted_image</span>, </span>
<span>                     categories_of_interest <span class="op">=</span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour"</span>, <span class="st">"Immune1"</span>, <span class="st">"Immune2"</span>, <span class="st">"Immune3"</span><span class="op">)</span>, </span>
<span>                     colour_vector <span class="op">=</span> <span class="va">my_colors</span>, feature_colname <span class="op">=</span> <span class="st">"Cell.Type"</span><span class="op">)</span></span></code></pre></div>
<p><img src="quality-control_visualisation_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p><code><a href="../reference/plot_cell_categories.html">plot_cell_categories()</a></code> also allows the users to plot the
categories layer by layer when there are too many cells by setting
<code>layered</code> parameter as <code>TRUE</code>. Then the cells will
be plotted in the order of <code>categories_of_interest</code> layer by
layer. Users can also use <code>cex</code> parameter to change the size
of the points.</p>
</div>
<div class="section level3">
<h3 id="d-surface-plot">3D surface plot<a class="anchor" aria-label="anchor" href="#d-surface-plot"></a>
</h3>
<p>We can visualise a selected marker in 3D with
<code><a href="../reference/marker_surface_plot.html">marker_surface_plot()</a></code>. The image is blurred based on the
<code>num_splits</code> parameter.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/marker_surface_plot.html">marker_surface_plot</a></span><span class="op">(</span><span class="va">formatted_image</span>, num_splits<span class="op">=</span><span class="fl">15</span>, marker<span class="op">=</span><span class="st">"Immune_marker1"</span><span class="op">)</span></span></code></pre></div>
<p>Due to the restriction of the file size, we have disabled the
interactive plot in this vignette. Here only shows a screen shot. (You
can interactively move the plot around to obtain a better view with the
same code).</p>
<p><img src="marker_surface1.jpg" width="75%"></p>
</div>
<div class="section level3">
<h3 id="d-stacked-surface-plot">3D stacked surface plot<a class="anchor" aria-label="anchor" href="#d-stacked-surface-plot"></a>
</h3>
<p>To visualise multiple markers in 3D in a single plot we can use
<code><a href="../reference/marker_surface_plot_stack.html">marker_surface_plot_stack()</a></code>. This shows normalised
intensity level of specified markers and enables the identification of
co-occurring and mutually exclusive markers.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/marker_surface_plot_stack.html">marker_surface_plot_stack</a></span><span class="op">(</span><span class="va">formatted_image</span>, num_splits<span class="op">=</span><span class="fl">15</span>, markers<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tumour_marker"</span>, <span class="st">"Immune_marker1"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="marker_surface2.jpg" width="75%"></p>
<p>The stacked surface plots of the Tumour_marker and Immune_marker1
cells in this example shows how Tumour_marker and Immune_marker1 are
mutually exclusive as the peaks and valleys are opposite. Similar to the
previous plot, we have disabled the interactive plot in the vignette.
(You can interactively move the plot around to obtain a better view with
the same code.)</p>
</div>
</div>
<div class="section level2">
<h2 id="you-can-access-the-vignettes-for-other-modules-of-spiat-here">You can access the vignettes for other modules of SPIAT here:<a class="anchor" aria-label="anchor" href="#you-can-access-the-vignettes-for-other-modules-of-spiat-here"></a>
</h2>
<ul>
<li><a href="SPIAT.html">Overview of SPIAT</a></li>
<li><a href="data_reading-formatting.html">Data reading and
formatting</a></li>
<li><a href="basic_analysis.html">Basic analysis</a></li>
<li><a href="cell-colocalisation.html">Cell colocalisation</a></li>
<li><a href="spatial-heterogeneity.html">Spatial heterogeneity</a></li>
<li><a href="tissue-structure.html">Tissue structure</a></li>
<li><a href="neighborhood.html">Cellular neighborhood</a></li>
</ul>
</div>
<div class="section level2">
<h2 id="reproducibility">Reproducibility<a class="anchor" aria-label="anchor" href="#reproducibility"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.3.2 (2023-10-31)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.3 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=C.UTF-8       LC_NUMERIC=C           LC_TIME=C.UTF-8       </span></span>
<span><span class="co">##  [4] LC_COLLATE=C.UTF-8     LC_MONETARY=C.UTF-8    LC_MESSAGES=C.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=C.UTF-8       LC_NAME=C              LC_ADDRESS=C          </span></span>
<span><span class="co">## [10] LC_TELEPHONE=C         LC_MEASUREMENT=C.UTF-8 LC_IDENTIFICATION=C   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## time zone: UTC</span></span>
<span><span class="co">## tzcode source: system (glibc)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">## [8] base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">##  [1] SPIAT_1.4.1                 SpatialExperiment_1.10.0   </span></span>
<span><span class="co">##  [3] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2</span></span>
<span><span class="co">##  [5] Biobase_2.60.0              GenomicRanges_1.52.1       </span></span>
<span><span class="co">##  [7] GenomeInfoDb_1.36.4         IRanges_2.34.1             </span></span>
<span><span class="co">##  [9] S4Vectors_0.38.2            BiocGenerics_0.46.0        </span></span>
<span><span class="co">## [11] MatrixGenerics_1.12.3       matrixStats_1.0.0          </span></span>
<span><span class="co">## [13] BiocStyle_2.28.1           </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##   [1] bitops_1.0-7              deldir_1.0-9             </span></span>
<span><span class="co">##   [3] gridExtra_2.3             rlang_1.1.1              </span></span>
<span><span class="co">##   [5] magrittr_2.0.3            compiler_4.3.2           </span></span>
<span><span class="co">##   [7] spatstat.geom_3.2-7       DelayedMatrixStats_1.22.6</span></span>
<span><span class="co">##   [9] systemfonts_1.0.5         vctrs_0.6.4              </span></span>
<span><span class="co">##  [11] stringr_1.5.0             pkgconfig_2.0.3          </span></span>
<span><span class="co">##  [13] crayon_1.5.2              fastmap_1.1.1            </span></span>
<span><span class="co">##  [15] magick_2.8.1              XVector_0.40.0           </span></span>
<span><span class="co">##  [17] labeling_0.4.3            scuttle_1.10.3           </span></span>
<span><span class="co">##  [19] utf8_1.2.4                rmarkdown_2.25           </span></span>
<span><span class="co">##  [21] pracma_2.4.2              ragg_1.2.6               </span></span>
<span><span class="co">##  [23] purrr_1.0.2               xfun_0.40                </span></span>
<span><span class="co">##  [25] zlibbioc_1.46.0           cachem_1.0.8             </span></span>
<span><span class="co">##  [27] beachmat_2.16.0           jsonlite_1.8.7           </span></span>
<span><span class="co">##  [29] goftest_1.2-3             highr_0.10               </span></span>
<span><span class="co">##  [31] rhdf5filters_1.12.1       DelayedArray_0.26.7      </span></span>
<span><span class="co">##  [33] spatstat.utils_3.0-4      Rhdf5lib_1.22.1          </span></span>
<span><span class="co">##  [35] BiocParallel_1.34.2       parallel_4.3.2           </span></span>
<span><span class="co">##  [37] R6_2.5.1                  bslib_0.5.1              </span></span>
<span><span class="co">##  [39] stringi_1.7.12            spatstat.data_3.0-3      </span></span>
<span><span class="co">##  [41] limma_3.56.2              jquerylib_0.1.4          </span></span>
<span><span class="co">##  [43] Rcpp_1.0.11               bookdown_0.36            </span></span>
<span><span class="co">##  [45] knitr_1.45                tensor_1.5               </span></span>
<span><span class="co">##  [47] R.utils_2.12.2            Matrix_1.6-1.1           </span></span>
<span><span class="co">##  [49] tidyselect_1.2.0          abind_1.4-5              </span></span>
<span><span class="co">##  [51] yaml_2.3.7                codetools_0.2-19         </span></span>
<span><span class="co">##  [53] spatstat.random_3.2-1     spatstat.explore_3.2-5   </span></span>
<span><span class="co">##  [55] lattice_0.21-9            tibble_3.2.1             </span></span>
<span><span class="co">##  [57] withr_2.5.2               Rtsne_0.16               </span></span>
<span><span class="co">##  [59] evaluate_0.22             desc_1.4.2               </span></span>
<span><span class="co">##  [61] polyclip_1.10-6           pillar_1.9.0             </span></span>
<span><span class="co">##  [63] BiocManager_1.30.22       plotly_4.10.3            </span></span>
<span><span class="co">##  [65] generics_0.1.3            rprojroot_2.0.3          </span></span>
<span><span class="co">##  [67] RCurl_1.98-1.12           ggplot2_3.4.4            </span></span>
<span><span class="co">##  [69] sparseMatrixStats_1.12.2  munsell_0.5.0            </span></span>
<span><span class="co">##  [71] scales_1.2.1              glue_1.6.2               </span></span>
<span><span class="co">##  [73] lazyeval_0.2.2            tools_4.3.2              </span></span>
<span><span class="co">##  [75] data.table_1.14.8         locfit_1.5-9.8           </span></span>
<span><span class="co">##  [77] fs_1.6.3                  rhdf5_2.44.0             </span></span>
<span><span class="co">##  [79] grid_4.3.2                tidyr_1.3.0              </span></span>
<span><span class="co">##  [81] crosstalk_1.2.0           DropletUtils_1.20.0      </span></span>
<span><span class="co">##  [83] edgeR_3.42.4              colorspace_2.1-0         </span></span>
<span><span class="co">##  [85] nlme_3.1-163              GenomeInfoDbData_1.2.10  </span></span>
<span><span class="co">##  [87] HDF5Array_1.28.1          mmand_1.6.3              </span></span>
<span><span class="co">##  [89] cli_3.6.1                 spatstat.sparse_3.0-3    </span></span>
<span><span class="co">##  [91] textshaping_0.3.7         fansi_1.0.5              </span></span>
<span><span class="co">##  [93] viridisLite_0.4.2         S4Arrays_1.0.6           </span></span>
<span><span class="co">##  [95] dplyr_1.1.3               gtable_0.3.4             </span></span>
<span><span class="co">##  [97] R.methodsS3_1.8.2         sass_0.4.7               </span></span>
<span><span class="co">##  [99] digest_0.6.33             dqrng_0.3.1              </span></span>
<span><span class="co">## [101] htmlwidgets_1.6.2         farver_2.1.1             </span></span>
<span><span class="co">## [103] rjson_0.2.21              memoise_2.0.1            </span></span>
<span><span class="co">## [105] htmltools_0.5.6.1         pkgdown_2.0.7            </span></span>
<span><span class="co">## [107] R.oo_1.25.0               lifecycle_1.0.3          </span></span>
<span><span class="co">## [109] httr_1.4.7</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="author-contributions">Author Contributions<a class="anchor" aria-label="anchor" href="#author-contributions"></a>
</h2>
<p>AT, YF, TY, ML, JZ, VO, MD are authors of the package code. MD and YF
wrote the vignette. AT, YF and TY designed the package.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Anna Trigos, Yuzhou Feng, Tianpei Yang, Mabel Li, John Zhu, Volkan Ozcoban, Maria Doyle.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
